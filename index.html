<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>robbygat.com by Robert Gatzke</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: white;
            font-family: Arial, sans-serif;
            position: relative;
        }
        canvas {
            display: block;
        }
        
        /* CRT Effect Overlay */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; /* Makes it clickable through */
            z-index: 2;
        }
        
        /* Additional CRT effects */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0.15;
            z-index: 2;
            pointer-events: none;
            animation: flicker 0.15s infinite alternate;
        }
        
        @keyframes flicker {
            0% {
                opacity: 0.15;
            }
            100% {
                opacity: 0.12;
            }
        }
    </style>
</head>
<body>
    <script>
        // Cell class definition
        class Cell {
            constructor(x, y, r, color, text, link) {
                this.position = createVector(x, y);
                this.velocity = p5.Vector.random2D().mult(random(0.5, 1.5));
                this.radius = r;
                this.baseRadius = r;
                this.pulseAmount = random(0.05, 0.15);
                this.pulseSpeed = random(0.01, 0.03);
                this.pulseOffset = random(0, TWO_PI);
                this.color = color;
                this.text = text;
                this.link = link;
                this.target = createVector(random(width), random(height));
                this.maxSpeed = random(1, 2);
                this.changeTargetCounter = 0;
                this.changeTargetInterval = random(100, 200);
            }

            update() {
                // AI behavior
                this.changeTargetCounter++;
                if (this.changeTargetCounter > this.changeTargetInterval) {
                    this.target = createVector(random(width), random(height));
                    this.changeTargetCounter = 0;
                    this.changeTargetInterval = random(100, 200);
                }

                // Pulse effect - slowly grow and shrink
                this.radius = this.baseRadius * (1 + this.pulseAmount * sin(frameCount * this.pulseSpeed + this.pulseOffset));
                
                // If this is a text cell, make sure we have a stable fontSize
                if (!this.isImage && !this.fontSize) {
                    // Calculate font size once and store it
                    let fontSize = this.baseRadius * 0.8;
                    textSize(fontSize);
                    while (textWidth(this.text) > this.baseRadius * 1.5 && fontSize > 8) {
                        fontSize -= 1;
                        textSize(fontSize);
                    }
                    this.fontSize = fontSize;
                }

                // Seek target
                let desired = p5.Vector.sub(this.target, this.position);
                let distance = desired.mag();
                
                if (distance < 100) {
                    let m = map(distance, 0, 100, 0, this.maxSpeed);
                    desired.setMag(m);
                } else {
                    desired.setMag(this.maxSpeed);
                }
                
                let steer = p5.Vector.sub(desired, this.velocity);
                steer.limit(0.1);
                this.velocity.add(steer);
                
                // Avoid other cells
                for (let other of cells) {
                    if (other !== this) {
                        let d = p5.Vector.dist(this.position, other.position);
                        if (d < this.radius + other.radius + 10) {
                            let avoid = p5.Vector.sub(this.position, other.position);
                            avoid.setMag(1);
                            this.velocity.add(avoid);
                            this.velocity.limit(this.maxSpeed);
                        }
                    }
                }
                
                // Avoid edges
                let buffer = 50;
                if (this.position.x < buffer) {
                    this.velocity.x += 0.1;
                } else if (this.position.x > width - buffer) {
                    this.velocity.x -= 0.1;
                }
                if (this.position.y < buffer) {
                    this.velocity.y += 0.1;
                } else if (this.position.y > height - buffer) {
                    this.velocity.y -= 0.1;
                }
                
                this.position.add(this.velocity);
            }

            draw() {
                // Cell body
                noStroke();
                fill(this.color);
                ellipse(this.position.x, this.position.y, this.radius * 2);
                
                // Cell text
                fill(255);
                textAlign(CENTER, CENTER);
                
                // Calculate the right text size to fit within the cell
                let fontSize = this.radius * 0.8; // Start with a default size
                textSize(fontSize);
                
                // Adjust text size to fit within the cell
                while (textWidth(this.text) > this.radius * 1.5 && fontSize > 8) {
                    fontSize -= 1;
                    textSize(fontSize);
                }
                
                text(this.text, this.position.x, this.position.y);
            }

            contains(px, py) {
                let d = dist(px, py, this.position.x, this.position.y);
                return d < this.radius;
            }
        }

        // p5.js setup
        let cells = [];
        let cellData = [
            { text: "X", link: "https://x.com/robbygat", color: "#1DA1F2" },
            { text: "Instagram", link: "https://www.instagram.com/robbygat/", color: "#C13584" },
            { text: "Rare Vance", link: "https://rarevance.com", color: "#FF6B6B" },
            { text: "Soon", link: "#", color: "#43AA8B" },
            { text: "Music", link: "https://linktr.ee/internetcowboy", color: "#F9C74F" },
            { text: "Photography", link: "https://www.instagram.com/robbygatzke/", color: "#8A2BE2" },
            { text: "Contact", link: "mailto:robby@robbygat.com", color: "#FF4500", isImage: true }
        ];

        function setup() {
            createCanvas(windowWidth, windowHeight);
            
            // Create cells
            for (let i = 0; i < cellData.length; i++) {
                let x = random(width);
                let y = random(height);
                let r = random(50, 70); // Slightly larger cells to better fit text
                cells.push(new Cell(x, y, r, cellData[i].color, cellData[i].text, cellData[i].link));
            }
        }

        function draw() {
            background(255);
            
            // Update and draw cells
            for (let cell of cells) {
                cell.update();
                cell.draw();
            }
        }

        function mousePressed() {
            // Check if mouse is over any cell
            for (let cell of cells) {
                if (cell.contains(mouseX, mouseY)) {
                    window.open(cell.link, '_blank');
                    return false; // Prevent default behavior
                }
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>
