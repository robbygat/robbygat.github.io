<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ETHERNET</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
    }
    #status, #balance, #transactions {
      margin-top: 20px;
      font-size: 18px;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      background: #f2f2f2;
      margin: 10px;
      padding: 10px;
      border-radius: 5px;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>ETHERNET</h1>
  <!-- Connect and Disconnect buttons -->
  <button id="connectButton">Connect MetaMask Wallet</button>
  <button id="disconnectButton" style="display: none;">Disconnect Wallet</button>
  
  <!-- Display connection status, balance, and transactions -->
  <div id="status">Not connected</div>
  <div id="balance"></div>
  <div id="transactions"></div>

  <script>
    const connectButton = document.getElementById('connectButton');
    const disconnectButton = document.getElementById('disconnectButton');
    const statusDiv = document.getElementById('status');
    const balanceDiv = document.getElementById('balance');
    const transactionsDiv = document.getElementById('transactions');
    
    // Your Etherscan API key (for mainnet)
    const ETHERSCAN_API_KEY = "0172ddf22ebd48dfa964f245aa01983f";
    
    let currentAccount = null;

    // Function to connect to MetaMask
    async function connectWallet() {
      if (typeof window.ethereum === 'undefined') {
        statusDiv.innerText = 'MetaMask is not installed!';
        return;
      }
      try {
        // Request connection to MetaMask wallet
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        currentAccount = accounts[0];
        statusDiv.innerText = `Connected: ${currentAccount}`;
        // Hide the connect button and show the disconnect button
        connectButton.style.display = 'none';
        disconnectButton.style.display = 'inline-block';
        // Fetch and display wallet balance and transactions
        fetchBalance(currentAccount);
        fetchTransactions(currentAccount);
      } catch (error) {
        console.error('Error connecting to MetaMask', error);
        statusDiv.innerText = 'Connection failed!';
      }
    }

    // Function to simulate wallet disconnection by clearing displayed data
    function disconnectWallet() {
      currentAccount = null;
      statusDiv.innerText = 'Not connected';
      balanceDiv.innerHTML = '';
      transactionsDiv.innerHTML = '';
      connectButton.style.display = 'inline-block';
      disconnectButton.style.display = 'none';
    }

    // Fetch the ETH balance using the Etherscan API
    async function fetchBalance(address) {
      try {
        // Etherscan API endpoint for ETH balance (returns balance in wei)
        const response = await fetch(`https://api.etherscan.io/api?module=account&action=balance&address=${address}&tag=latest&apikey=${ETHERSCAN_API_KEY}`);
        const data = await response.json();
        if(data.status === "1") {
          // Convert wei to ETH
          const balanceInWei = data.result;
          const balanceInEth = balanceInWei / 1e18;
          balanceDiv.innerHTML = `<p>Balance: ${balanceInEth} ETH</p>`;
        } else {
          balanceDiv.innerHTML = `<p>Error fetching balance: ${data.message}</p>`;
        }
      } catch (error) {
        console.error('Error fetching balance:', error);
        balanceDiv.innerHTML = `<p>Error fetching balance.</p>`;
      }
    }

    // Fetch the last 10 transactions using the Etherscan API
    async function fetchTransactions(address) {
      try {
        // Etherscan API endpoint for transaction history (last 10 transactions, sorted descending)
        const response = await fetch(`https://api.etherscan.io/api?module=account&action=txlist&address=${address}&startblock=0&endblock=99999999&page=1&offset=10&sort=desc&apikey=${ETHERSCAN_API_KEY}`);
        const data = await response.json();
        if(data.status === "1") {
          const transactions = data.result;
          let txHTML = '<h3>Last 10 Transactions:</h3><ul>';
          transactions.forEach(tx => {
            txHTML += `<li>
              <strong>From:</strong> ${tx.from} <br>
              <strong>To:</strong> ${tx.to} <br>
              <strong>Value:</strong> ${tx.value / 1e18} ETH
            </li>`;
          });
          txHTML += '</ul>';
          transactionsDiv.innerHTML = txHTML;
        } else {
          transactionsDiv.innerHTML = `<p>Error fetching transactions: ${data.message}</p>`;
        }
      } catch (error) {
        console.error('Error fetching transactions:', error);
        transactionsDiv.innerHTML = `<p>Error fetching transactions.</p>`;
      }
    }

    // Event listeners for the buttons
    connectButton.addEventListener('click', connectWallet);
    disconnectButton.addEventListener('click', disconnectWallet);
  </script>
</body>
</html>
