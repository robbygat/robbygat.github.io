<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ETHERNET NFT Displayer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
    }
    /* Container for the NFT gallery with scroll enabled */
    #nftContainer {
      margin-top: 30px;
      max-height: 600px; /* Adjust as needed */
      overflow-y: auto;
      padding: 10px;
      border: 1px solid #ccc;
    }
    /* Grid layout for NFTs: 5 columns */
    #nftGallery {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-gap: 10px;
    }
    .nft {
      border: 1px solid #ccc;
      padding: 10px;
      word-break: break-all;
    }
    .nft img {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <h1>ETHERNET NFT Displayer</h1>
  <button id="connectButton">Connect MetaMask Wallet</button>
  <button id="disconnectButton" style="display:none;">Disconnect Wallet</button>
  <div id="status">Not connected</div>
  <div id="nftContainer">
    <div id="nftGallery"></div>
  </div>

  <script>
    // Your provided API key for Alchemy (mainnet)
    const API_KEY = "0172ddf22ebd48dfa964f245aa01983f";
    // Base URL for the Alchemy NFT API on Ethereum mainnet
    const BASE_URL = `https://eth-mainnet.alchemyapi.io/v2/${API_KEY}/getNFTs/`;
    
    let currentAccount = null;

    const connectButton = document.getElementById('connectButton');
    const disconnectButton = document.getElementById('disconnectButton');
    const statusDiv = document.getElementById('status');
    const nftGallery = document.getElementById('nftGallery');

    async function connectWallet() {
      if (typeof window.ethereum === 'undefined') {
        statusDiv.innerText = 'MetaMask is not installed!';
        return;
      }
      
      try {
        // Request account access
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        currentAccount = accounts[0];
        statusDiv.innerText = `Connected: ${currentAccount}`;
        connectButton.style.display = 'none';
        disconnectButton.style.display = 'inline-block';
        // Fetch and display NFTs for the connected wallet
        fetchNFTs(currentAccount);
      } catch (error) {
        console.error('Error connecting to MetaMask', error);
        statusDiv.innerText = 'Connection failed!';
      }
    }

    function disconnectWallet() {
      // Reset the local state
      currentAccount = null;
      statusDiv.innerText = 'Not connected';
      nftGallery.innerHTML = '';
      connectButton.style.display = 'inline-block';
      disconnectButton.style.display = 'none';
    }

    async function fetchNFTs(account) {
      // Construct the API URL for fetching NFTs owned by the account
      const fetchURL = `${BASE_URL}?owner=${account}`;
      try {
        const response = await fetch(fetchURL);
        const data = await response.json();
        nftGallery.innerHTML = '';
        if (data && data.ownedNfts && data.ownedNfts.length > 0) {
          data.ownedNfts.forEach(nft => {
            const nftDiv = document.createElement('div');
            nftDiv.className = 'nft';

            // Extract NFT image URL (handling ipfs:// protocol if necessary)
            let imgUrl = '';
            if (nft.metadata && nft.metadata.image) {
              imgUrl = nft.metadata.image;
              if (imgUrl.startsWith("ipfs://")) {
                imgUrl = imgUrl.replace("ipfs://", "https://ipfs.io/ipfs/");
              }
            }

            nftDiv.innerHTML = `
              <h3>${nft.title || 'Unnamed NFT'}</h3>
              ${imgUrl ? `<img src="${imgUrl}" alt="NFT Image" />` : '<p>No image available</p>'}
              <p>Contract: ${nft.contract.address}</p>
            `;
            nftGallery.appendChild(nftDiv);
          });
        } else {
          nftGallery.innerHTML = '<p>No NFTs found for this wallet.</p>';
        }
      } catch (error) {
        console.error('Error fetching NFTs:', error);
        nftGallery.innerHTML = '<p>Error fetching NFTs.</p>';
      }
    }

    connectButton.addEventListener('click', connectWallet);
    disconnectButton.addEventListener('click', disconnectWallet);

    // Listen for account changes to update the display accordingly
    if (window.ethereum) {
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length > 0) {
          currentAccount = accounts[0];
          statusDiv.innerText = `Connected: ${currentAccount}`;
          fetchNFTs(currentAccount);
        } else {
          disconnectWallet();
        }
      });
    }
  </script>
</body>
</html>
